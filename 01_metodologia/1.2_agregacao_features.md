# 1.2 Etapa 1: Agregação de Features

## Visão Geral

A etapa de agregação combina dados de múltiplas fontes e cria features complementares. Esta etapa prepara o dataset unificado que será usado para feature engineering e modelagem.

## Objetivos

1. Combinar dados ativos e inativos em um único dataset
2. Unificar formatos e nomenclaturas
3. Agregar informações complementares
4. Preparar dados para feature engineering
5. Garantir consistência entre fontes

## Arquivo de Implementação

**Notebook:** `08_codigo/notebooks/0.2.3_juntar_dados.ipynb`

**Dependências:**
- Etapa 0: Limpeza (`1.1_limpeza_dados.md`)
- Notebooks auxiliares: `0.2.1_AtivosV1.ipynb`, `0.2.2_InativosV1.ipynb`

## Metodologia

### 1. Processamento de Empresas Ativas

```python
# Processar estabelecimentos ativos
df_ativos = processar_ativos(df_limpo)

# Features específicas de ativos
df_ativos['status'] = 'ATIVO'
df_ativos['data_ultima_atualizacao'] = pd.Timestamp.now()
```

### 2. Processamento de Empresas Inativas

```python
# Processar estabelecimentos inativos/baixados
df_inativos = processar_inativos(df_limpo)

# Features específicas de inativos
df_inativos['status'] = 'INATIVO'
df_inativos['motivo_inativacao'] = df_inativos['motivo_situacao_cadastral']
```

### 3. Unificação de Datasets

```python
# Concatenar ativos e inativos
df_unificado = pd.concat([df_ativos, df_inativos], ignore_index=True)

# Verificar integridade
assert len(df_unificado) == len(df_ativos) + len(df_inativos)
assert not df_unificado['cnpj_basico'].duplicated().any()
```

## Saída

**Arquivo:** Dataset unificado pronto para feature engineering

**Próxima Etapa:** [1.3 Feature Engineering](1.3_feature_engineering.md)

---

**Documento:** 1.2_agregacao_features.md  
**Versão:** 1.0  
**Data:** Dezembro 2024

